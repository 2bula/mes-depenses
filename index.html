<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Mes Finances">
    <title>Gestionnaire de DÃ©penses</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { PlusCircle, TrendingDown, TrendingUp, Calendar, Trash2 } = lucide;

        function ExpenseTracker() {
          const [transactions, setTransactions] = useState([]);
          const [amount, setAmount] = useState('');
          const [description, setDescription] = useState('');
          const [type, setType] = useState('expense');
          const [view, setView] = useState('add');
          const [filterPeriod, setFilterPeriod] = useState('all');
          const [loading, setLoading] = useState(true);

          useEffect(() => {
            loadTransactions();
          }, []);

          const loadTransactions = async () => {
            try {
              const result = await window.storage.get('transactions');
              if (result && result.value) {
                setTransactions(JSON.parse(result.value));
              }
            } catch (error) {
              console.log('Aucune donnÃ©e existante');
            } finally {
              setLoading(false);
            }
          };

          const saveTransactions = async (newTransactions) => {
            try {
              await window.storage.set('transactions', JSON.stringify(newTransactions));
            } catch (error) {
              console.error('Erreur de sauvegarde:', error);
              alert('Erreur lors de la sauvegarde des donnÃ©es');
            }
          };

          const addTransaction = async () => {
            if (!amount || !description) {
              alert('Veuillez remplir tous les champs');
              return;
            }

            const newTransaction = {
              id: Date.now(),
              amount: parseFloat(amount),
              description,
              type,
              date: new Date().toISOString()
            };

            const updated = [newTransaction, ...transactions];
            setTransactions(updated);
            await saveTransactions(updated);

            setAmount('');
            setDescription('');
            alert('Transaction enregistrÃ©e!');
          };

          const deleteTransaction = async (id) => {
            if (confirm('Supprimer cette transaction?')) {
              const updated = transactions.filter(t => t.id !== id);
              setTransactions(updated);
              await saveTransactions(updated);
            }
          };

          const getFilteredTransactions = () => {
            const now = new Date();
            return transactions.filter(t => {
              const transDate = new Date(t.date);
              switch(filterPeriod) {
                case 'today':
                  return transDate.toDateString() === now.toDateString();
                case 'week':
                  const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                  return transDate >= weekAgo;
                case 'month':
                  return transDate.getMonth() === now.getMonth() && 
                         transDate.getFullYear() === now.getFullYear();
                case 'year':
                  return transDate.getFullYear() === now.getFullYear();
                default:
                  return true;
              }
            });
          };

          const filteredTransactions = getFilteredTransactions();
          const expenses = filteredTransactions.filter(t => t.type === 'expense');
          const income = filteredTransactions.filter(t => t.type === 'income');
          
          const totalExpenses = expenses.reduce((sum, t) => sum + t.amount, 0);
          const totalIncome = income.reduce((sum, t) => sum + t.amount, 0);
          const balance = totalIncome - totalExpenses;

          if (loading) {
            return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center" },
              React.createElement('div', { className: "text-xl text-gray-600" }, 'Chargement...')
            );
          }

          return (
            React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 pb-24" },
              React.createElement('div', { className: "bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-6 shadow-lg" },
                React.createElement('h1', { className: "text-3xl font-bold mb-4" }, 'ðŸ’° Mes Finances'),
                
                view === 'history' && filterPeriod !== 'all' && React.createElement('div', { className: "bg-white/30 backdrop-blur rounded-lg p-3 mb-3" },
                  React.createElement('div', { className: "text-xs opacity-90 mb-1" }, 'Solde de la pÃ©riode sÃ©lectionnÃ©e'),
                  React.createElement('div', { className: "text-2xl font-bold" }, balance.toFixed(2) + '$'),
                  React.createElement('div', { className: "text-xs opacity-90 mt-1" }, 
                    totalIncome.toFixed(2) + '$ - ' + totalExpenses.toFixed(2) + '$'
                  )
                ),
                
                React.createElement('div', { className: "grid grid-cols-3 gap-3" },
                  React.createElement('div', { className: "bg-white/20 backdrop-blur rounded-lg p-3" },
                    React.createElement('div', { className: "text-xs opacity-90" }, 'Solde'),
                    React.createElement('div', { className: "text-xl font-bold" }, balance.toFixed(2) + '$')
                  ),
                  React.createElement('div', { className: "bg-white/20 backdrop-blur rounded-lg p-3" },
                    React.createElement('div', { className: "text-xs opacity-90" }, 'Revenus'),
                    React.createElement('div', { className: "text-xl font-bold text-green-300" }, '+' + totalIncome.toFixed(2) + '$')
                  ),
                  React.createElement('div', { className: "bg-white/20 backdrop-blur rounded-lg p-3" },
                    React.createElement('div', { className: "text-xs opacity-90" }, 'DÃ©penses'),
                    React.createElement('div', { className: "text-xl font-bold text-red-300" }, '-' + totalExpenses.toFixed(2) + '$')
                  )
                )
              ),

              React.createElement('div', { className: "p-4" },
                view === 'add' ? 
                  React.createElement('div', { className: "bg-white rounded-xl shadow-lg p-6" },
                    React.createElement('h2', { className: "text-xl font-bold mb-4 text-gray-800" }, 'Nouvelle transaction'),
                    
                    React.createElement('div', { className: "space-y-4" },
                      React.createElement('div', null,
                        React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, 'Type'),
                        React.createElement('div', { className: "grid grid-cols-2 gap-2" },
                          React.createElement('button', {
                            onClick: () => setType('expense'),
                            className: `p-3 rounded-lg font-medium transition ${type === 'expense' ? 'bg-red-500 text-white' : 'bg-gray-100 text-gray-700'}`
                          }, 'ðŸ“‰ DÃ©pense'),
                          React.createElement('button', {
                            onClick: () => setType('income'),
                            className: `p-3 rounded-lg font-medium transition ${type === 'income' ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-700'}`
                          }, 'ðŸ“ˆ Revenu')
                        )
                      ),

                      React.createElement('div', null,
                        React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, 'Montant ($)'),
                        React.createElement('input', {
                          type: "number",
                          step: "0.01",
                          value: amount,
                          onChange: (e) => setAmount(e.target.value),
                          placeholder: "0.00",
                          className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        })
                      ),

                      React.createElement('div', null,
                        React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, 'Description'),
                        React.createElement('input', {
                          type: "text",
                          value: description,
                          onChange: (e) => setDescription(e.target.value),
                          placeholder: "Ex: Ã‰picerie, Salaire, etc.",
                          className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        })
                      ),

                      React.createElement('button', {
                        onClick: addTransaction,
                        className: "w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-4 rounded-lg font-semibold hover:shadow-lg transition"
                      }, 'âž• Ajouter')
                    )
                  ) :
                  React.createElement('div', { className: "bg-white rounded-xl shadow-lg p-6" },
                    React.createElement('div', { className: "flex justify-between items-center mb-4" },
                      React.createElement('h2', { className: "text-xl font-bold text-gray-800" }, 'Historique'),
                      React.createElement('select', {
                        value: filterPeriod,
                        onChange: (e) => setFilterPeriod(e.target.value),
                        className: "p-2 border border-gray-300 rounded-lg text-sm"
                      },
                        React.createElement('option', { value: "all" }, 'Tout'),
                        React.createElement('option', { value: "today" }, "Aujourd'hui"),
                        React.createElement('option', { value: "week" }, '7 derniers jours'),
                        React.createElement('option', { value: "month" }, 'Ce mois'),
                        React.createElement('option', { value: "year" }, 'Cette annÃ©e')
                      )
                    ),

                    React.createElement('div', { className: "space-y-2 max-h-96 overflow-y-auto" },
                      filteredTransactions.length === 0 ?
                        React.createElement('div', { className: "text-center text-gray-400 py-8" }, 'Aucune transaction') :
                        filteredTransactions.map(transaction =>
                          React.createElement('div', {
                            key: transaction.id,
                            className: "flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition"
                          },
                            React.createElement('div', { className: "flex items-center space-x-3" },
                              React.createElement('div', { 
                                className: `p-2 rounded-full ${transaction.type === 'expense' ? 'bg-red-100' : 'bg-green-100'}`
                              }, transaction.type === 'expense' ? 'ðŸ“‰' : 'ðŸ“ˆ'),
                              React.createElement('div', null,
                                React.createElement('div', { className: "font-medium text-gray-800" }, transaction.description),
                                React.createElement('div', { className: "text-xs text-gray-500" },
                                  new Date(transaction.date).toLocaleDateString('fr-CA', {
                                    day: 'numeric',
                                    month: 'short',
                                    year: 'numeric'
                                  })
                                )
                              )
                            ),
                            React.createElement('div', { className: "flex items-center space-x-2" },
                              React.createElement('span', { 
                                className: `font-bold ${transaction.type === 'expense' ? 'text-red-600' : 'text-green-600'}`
                              }, (transaction.type === 'expense' ? '-' : '+') + transaction.amount.toFixed(2) + '$'),
                              React.createElement('button', {
                                onClick: () => deleteTransaction(transaction.id),
                                className: "p-1 text-red-500 hover:bg-red-50 rounded"
                              }, 'ðŸ—‘ï¸')
                            )
                          )
                        )
                    )
                  )
              ),

              React.createElement('div', { className: "fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg" },
                React.createElement('div', { className: "grid grid-cols-2" },
                  React.createElement('button', {
                    onClick: () => setView('add'),
                    className: `p-4 flex flex-col items-center transition ${view === 'add' ? 'text-indigo-600 bg-indigo-50' : 'text-gray-600'}`
                  },
                    React.createElement('span', { style: { fontSize: '24px' } }, 'âž•'),
                    React.createElement('span', { className: "text-xs mt-1 font-medium" }, 'Ajouter')
                  ),
                  React.createElement('button', {
                    onClick: () => setView('history'),
                    className: `p-4 flex flex-col items-center transition ${view === 'history' ? 'text-indigo-600 bg-indigo-50' : 'text-gray-600'}`
                  },
                    React.createElement('span', { style: { fontSize: '24px' } }, 'ðŸ“…'),
                    React.createElement('span', { className: "text-xs mt-1 font-medium" }, 'Historique')
                  )
                )
              )
            )
          );
        }

        ReactDOM.render(React.createElement(ExpenseTracker), document.getElementById('root'));
    </script>
</body>
</html>
